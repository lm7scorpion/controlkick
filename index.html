<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Entrega de Videos</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel para JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Iconos de Lucide (simulados con SVG)
    const Clock = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
    const StopCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><rect x="9" y="9" width="6" height="6"/></svg>;
    const RotateCcw = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>;
    const TrendingUp = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>;
    const Save = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
    const BarChart3 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>;
    const History = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>;
    const Camera = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>;
    const Download = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
    const Copy = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;

    function ControlTiempoTrabajos() {
      const archivos = ['G1', 'G2', 'G3', 'G4', 'G5', 'G6', 'G7'];
      
      const [fechaActual, setFechaActual] = useState(() => {
        const hoy = new Date();
        return hoy.toISOString().split('T')[0];
      });
      
      const [trabajosActivos, setTrabajosActivos] = useState(() => {
        const inicial = {};
        archivos.forEach(archivo => {
          inicial[archivo] = {
            horaInicio: '',
            periodoInicio: 'PM',
            horaFin: '',
            periodoFin: 'AM',
            diaSiguiente: false,
            enProceso: false
          };
        });
        return inicial;
      });
      
      const [historial, setHistorial] = useState([]);
      const [mostrarEstadisticas, setMostrarEstadisticas] = useState(false);
      const [mostrarHistorial, setMostrarHistorial] = useState(false);
      const [tiempoActual, setTiempoActual] = useState(new Date());
      
      useEffect(() => {
        const intervalo = setInterval(() => {
          setTiempoActual(new Date());
        }, 1000);
        return () => clearInterval(intervalo);
      }, []);
      
      useEffect(() => {
        const guardado = localStorage.getItem('historial-transformaciones');
        if (guardado) {
          setHistorial(JSON.parse(guardado));
        }
      }, []);
      
      useEffect(() => {
        if (historial.length > 0) {
          localStorage.setItem('historial-transformaciones', JSON.stringify(historial));
        }
      }, [historial]);

      const convertirA24Horas = (hora, periodo) => {
        if (!hora) return null;
        let [h, m] = hora.split(':').map(Number);
        if (periodo === 'PM' && h !== 12) h += 12;
        if (periodo === 'AM' && h === 12) h = 0;
        return { horas: h, minutos: m };
      };

      const calcularTiempoTranscurrido = (horaInicio, periodoInicio, horaFin, periodoFin, diaSiguiente, archivo) => {
        if (!horaInicio) return { horas: 0, minutos: 0, segundos: 0, totalMinutos: 0 };
        
        const inicio = convertirA24Horas(horaInicio, periodoInicio);
        if (!inicio) return { horas: 0, minutos: 0, segundos: 0, totalMinutos: 0 };
        
        let inicioDate = new Date();
        inicioDate.setHours(inicio.horas, inicio.minutos, 0, 0);
        
        // Verificar si hay un video anterior con recepci√≥n cercana (menos de 1h 30min)
        const archivosOrdenados = archivos.filter(a => {
          const trabajo = trabajosActivos[a];
          return trabajo.horaInicio && a !== archivo;
        }).sort((a, b) => {
          const trabajoA = trabajosActivos[a];
          const trabajoB = trabajosActivos[b];
          const horaA = convertirA24Horas(trabajoA.horaInicio, trabajoA.periodoInicio);
          const horaB = convertirA24Horas(trabajoB.horaInicio, trabajoB.periodoInicio);
          return (horaA.horas * 60 + horaA.minutos) - (horaB.horas * 60 + horaB.minutos);
        });
        
        // Buscar video anterior cercano
        for (let otroArchivo of archivosOrdenados) {
          const otroTrabajo = trabajosActivos[otroArchivo];
          const otroInicio = convertirA24Horas(otroTrabajo.horaInicio, otroTrabajo.periodoInicio);
          
          if (!otroInicio) continue;
          
          const otroInicioDate = new Date();
          otroInicioDate.setHours(otroInicio.horas, otroInicio.minutos, 0, 0);
          
          // Si el otro archivo fue recibido antes que el actual
          if (otroInicioDate < inicioDate) {
            const diferenciaMinutos = (inicioDate - otroInicioDate) / (1000 * 60);
            
            // Si la diferencia es menor a 90 minutos (1h 30min)
            if (diferenciaMinutos < 90) {
              // Ajustar el inicio del actual: debe ser otroInicio + 90 minutos
              inicioDate = new Date(otroInicioDate.getTime() + (90 * 60 * 1000));
            }
          }
        }
        
        let finDate;
        if (horaFin) {
          const fin = convertirA24Horas(horaFin, periodoFin);
          if (!fin) return { horas: 0, minutos: 0, segundos: 0, totalMinutos: 0 };
          finDate = new Date();
          finDate.setHours(fin.horas, fin.minutos, 0, 0);
          if (diaSiguiente) {
            finDate.setDate(finDate.getDate() + 1);
          }
        } else {
          finDate = tiempoActual;
        }
        
        let diffMs = finDate - inicioDate;
        if (diffMs < 0) diffMs += 24 * 60 * 60 * 1000;
        
        const almuerzoInicio = new Date();
        almuerzoInicio.setHours(12, 0, 0, 0);
        const almuerzoFin = new Date();
        almuerzoFin.setHours(13, 30, 0, 0);
        
        let tiempoPausaMs = 0;
        
        if (inicioDate < almuerzoFin && finDate > almuerzoInicio) {
          const inicioEfectivo = inicioDate > almuerzoInicio ? inicioDate : almuerzoInicio;
          const finEfectivo = finDate < almuerzoFin ? finDate : almuerzoFin;
          
          if (finEfectivo > inicioEfectivo) {
            tiempoPausaMs = finEfectivo - inicioEfectivo;
          }
        }
        
        diffMs -= tiempoPausaMs;
        
        const totalSegundos = Math.floor(diffMs / 1000);
        const horas = Math.floor(totalSegundos / 3600);
        const minutos = Math.floor((totalSegundos % 3600) / 60);
        const segundos = totalSegundos % 60;
        const totalMinutos = Math.floor(totalSegundos / 60);
        
        return { horas, minutos, segundos, totalMinutos };
      };

      const cambiarHoraInicio = (archivo, hora) => {
        setTrabajosActivos(prev => ({
          ...prev,
          [archivo]: {
            ...prev[archivo],
            horaInicio: hora
          }
        }));
      };

      const cambiarPeriodoInicio = (archivo, periodo) => {
        setTrabajosActivos(prev => ({
          ...prev,
          [archivo]: {
            ...prev[archivo],
            periodoInicio: periodo
          }
        }));
      };

      const cambiarHoraFin = (archivo, hora) => {
        setTrabajosActivos(prev => ({
          ...prev,
          [archivo]: {
            ...prev[archivo],
            horaFin: hora,
            enProceso: false
          }
        }));
      };

      const cambiarPeriodoFin = (archivo, periodo) => {
        setTrabajosActivos(prev => ({
          ...prev,
          [archivo]: {
            ...prev[archivo],
            periodoFin: periodo,
            enProceso: false
          }
        }));
      };

      const toggleDiaSiguiente = (archivo) => {
        setTrabajosActivos(prev => ({
          ...prev,
          [archivo]: {
            ...prev[archivo],
            diaSiguiente: !prev[archivo].diaSiguiente
          }
        }));
      };

      const reiniciarTrabajo = (archivo) => {
        setTrabajosActivos(prev => ({
          ...prev,
          [archivo]: {
            horaInicio: '',
            periodoInicio: 'PM',
            horaFin: '',
            periodoFin: 'AM',
            diaSiguiente: false,
            enProceso: false
          }
        }));
      };

      const obtenerColorRendimiento = (minutos, esExonerado = false) => {
        if (esExonerado) return 'from-green-500 to-emerald-500';
        if (minutos <= 60) return 'from-green-500 to-emerald-500';
        if (minutos <= 90) return 'from-blue-500 to-cyan-500';
        if (minutos <= 150) return 'from-purple-500 to-violet-500';
        if (minutos <= 180) return 'from-yellow-500 to-orange-500';
        return 'from-red-600 to-pink-600';
      };

      const verificarExoneracion = (horaInicio, periodoInicio, horaFin, periodoFin) => {
        if (!horaInicio || !horaFin) return false;
        
        const inicio = convertirA24Horas(horaInicio, periodoInicio);
        const fin = convertirA24Horas(horaFin, periodoFin);
        
        if (!inicio || !fin) return false;
        
        const estaEnRangoRecepcion = (inicio.horas >= 22) || (inicio.horas <= 1);
        const finalizaAntesDe9AM = fin.horas < 9;
        
        return estaEnRangoRecepcion && finalizaAntesDe9AM;
      };

      const obtenerClasificacionProductividad = (minutos, horaInicio, periodoInicio, horaFin, periodoFin) => {
        if (horaInicio && horaFin && verificarExoneracion(horaInicio, periodoInicio, horaFin, periodoFin)) {
          return { 
            nombre: 'Rendimiento √ìptimo', 
            emoji: '‚úÖ', 
            color: 'text-green-400',
            bg: 'bg-green-500/20',
            exonerado: true
          };
        }
        
        // 0 - 60 min = Rendimiento √ìptimo
        if (minutos <= 60) return { 
          nombre: 'Rendimiento √ìptimo', 
          emoji: '‚úÖ', 
          color: 'text-green-400',
          bg: 'bg-green-500/20'
        };
        // 61 - 90 min = Plazo M√°ximo
        if (minutos <= 90) return { 
          nombre: 'Plazo M√°ximo', 
          emoji: 'üéØ', 
          color: 'text-cyan-400',
          bg: 'bg-cyan-500/20'
        };
        // 91 - 150 min = Entrega Atrasada
        if (minutos <= 150) return { 
          nombre: 'Entrega Atrasada', 
          emoji: '‚è∞', 
          color: 'text-purple-400',
          bg: 'bg-purple-500/20'
        };
        // 151 - 180 min = Entrega Tard√≠a
        if (minutos <= 180) return { 
          nombre: 'Entrega Tard√≠a', 
          emoji: '‚ö†Ô∏è', 
          color: 'text-yellow-400',
          bg: 'bg-yellow-500/20'
        };
        // M√°s de 180 min = Entrega Nula
        return { 
          nombre: 'Entrega Nula', 
          emoji: '‚úñÔ∏è', 
          color: 'text-red-400',
          bg: 'bg-red-500/20'
        };
      };

      const obtenerDiaSemana = (fecha) => {
        const date = new Date(fecha + 'T00:00:00');
        const dia = date.getDay();
        const diasMap = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
        return diasMap[dia];
      };

      const generarTextoReporte = (dia) => {
        let texto = `CONTROL DE ENTREGA DE VIDEOS\n`;
        texto += `================================\n`;
        texto += `Fecha: ${dia.fecha}\n`;
        texto += `D√≠a: ${dia.diaSemana}\n`;
        texto += `================================\n\n`;
        
        if (Object.keys(dia.archivos).length === 0) {
          texto += 'No hay archivos procesados\n';
        } else {
          Object.entries(dia.archivos).forEach(([archivo, datos]) => {
            texto += `${archivo}: ${datos.horaInicio} - ${datos.horaFin}\n`;
            texto += `Resultado: ${datos.duracion.horas}h ${datos.duracion.minutos}min = ${datos.clasificacion.toUpperCase()}`;
            if (datos.exonerado) {
              texto += ` (Exonerado)`;
            }
            texto += `\n\n`;
          });
        }
        
        return texto;
      };

      const copiarTextoAlPortapapeles = (dia) => {
        const texto = generarTextoReporte(dia);
        navigator.clipboard.writeText(texto).then(() => {
          alert('‚úÖ Texto copiado al portapapeles');
        }).catch(err => {
          console.error('Error al copiar:', err);
          alert('‚ùå Error al copiar el texto');
        });
      };

      const descargarReporteTxt = (dia) => {
        const texto = generarTextoReporte(dia);
        
        const date = new Date(dia.fecha + 'T00:00:00');
        const diaNombre = dia.diaSemana.toLowerCase();
        const diaNum = date.getDate();
        const meses = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];
        const mesNombre = meses[date.getMonth()];
        
        const nombreArchivo = `${diaNombre}${diaNum}${mesNombre}_controlvg.txt`;
        
        const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = nombreArchivo;
        link.click();
        URL.revokeObjectURL(url);
        
        alert('‚úÖ Reporte descargado exitosamente');
      };

      const guardarDia = () => {
        const hayDatos = Object.values(trabajosActivos).some(t => t.horaInicio || t.horaFin);
        
        if (!hayDatos) {
          alert('No hay datos para guardar. Registra al menos un archivo.');
          return;
        }

        const archivosConTiempo = {};
        archivos.forEach(archivo => {
          const trabajo = trabajosActivos[archivo];
          if (trabajo.horaInicio && trabajo.horaFin) {
            const tiempo = calcularTiempoTranscurrido(trabajo.horaInicio, trabajo.periodoInicio, trabajo.horaFin, trabajo.periodoFin, trabajo.diaSiguiente, archivo);
            const clasificacion = obtenerClasificacionProductividad(tiempo.totalMinutos, trabajo.horaInicio, trabajo.periodoInicio, trabajo.horaFin, trabajo.periodoFin);
            archivosConTiempo[archivo] = {
              horaInicio: `${trabajo.horaInicio} ${trabajo.periodoInicio}`,
              horaFin: `${trabajo.horaFin} ${trabajo.periodoFin}${trabajo.diaSiguiente ? ' +1' : ''}`,
              duracion: tiempo,
              clasificacion: clasificacion.nombre,
              exonerado: clasificacion.exonerado || false
            };
          }
        });

        const nuevoRegistro = {
          id: Date.now(),
          fecha: fechaActual,
          diaSemana: obtenerDiaSemana(fechaActual),
          archivos: archivosConTiempo
        };

        const existe = historial.find(h => h.fecha === fechaActual);
        if (existe) {
          if (!confirm('Ya existe un registro para esta fecha. ¬øDeseas sobrescribirlo?')) {
            return;
          }
          setHistorial(prev => prev.map(h => h.fecha === fechaActual ? nuevoRegistro : h));
        } else {
          setHistorial(prev => [nuevoRegistro, ...prev]);
        }

        alert('¬°D√≠a guardado exitosamente!');
        
        const inicial = {};
        archivos.forEach(archivo => {
          inicial[archivo] = {
            horaInicio: '',
            periodoInicio: 'PM',
            horaFin: '',
            periodoFin: 'AM',
            diaSiguiente: false,
            enProceso: false
          };
        });
        setTrabajosActivos(inicial);
      };

      const tomarCapturaPantalla = async () => {
        try {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
          
          await new Promise((resolve, reject) => {
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
          
          await new Promise(resolve => setTimeout(resolve, 100));
          
          const canvas = await window.html2canvas(document.body, {
            backgroundColor: '#1a1625',
            scale: 2,
            logging: false,
            useCORS: true,
            allowTaint: true
          });
          
          canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            const fecha = new Date().toISOString().split('T')[0];
            const hora = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }).replace(/:/g, '-');
            link.download = `control-videos-${fecha}-${hora}.png`;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Captura de pantalla guardada exitosamente');
          });
          
        } catch (error) {
          console.error('Error al tomar captura:', error);
          alert('‚ùå Error al tomar la captura. Por favor, intenta de nuevo.');
        }
      };

      const calcularEstadisticasGenerales = () => {
        if (historial.length === 0) return null;

        let totalArchivos = 0;
        let sumaMinutos = 0;
        let archivoStats = {};
        
        let clasificaciones = {
          'Rendimiento √ìptimo': 0,
          'Plazo M√°ximo': 0,
          'Entrega Atrasada': 0,
          'Entrega Tard√≠a': 0,
          'Entrega Nula': 0
        };
        
        archivos.forEach(archivo => {
          archivoStats[archivo] = {
            total: 0,
            sumaMinutos: 0,
            mejorTiempo: null,
            peorTiempo: null
          };
        });

        historial.forEach(dia => {
          if (dia.archivos) {
            Object.entries(dia.archivos).forEach(([archivo, datos]) => {
              totalArchivos++;
              sumaMinutos += datos.duracion.totalMinutos;
              
              if (datos.clasificacion) {
                clasificaciones[datos.clasificacion]++;
              }
              
              archivoStats[archivo].total++;
              archivoStats[archivo].sumaMinutos += datos.duracion.totalMinutos;
              
              if (!archivoStats[archivo].mejorTiempo || datos.duracion.totalMinutos < archivoStats[archivo].mejorTiempo) {
                archivoStats[archivo].mejorTiempo = datos.duracion.totalMinutos;
              }
              
              if (!archivoStats[archivo].peorTiempo || datos.duracion.totalMinutos > archivoStats[archivo].peorTiempo) {
                archivoStats[archivo].peorTiempo = datos.duracion.totalMinutos;
              }
            });
          }
        });

        const promedioGeneral = totalArchivos > 0 ? sumaMinutos / totalArchivos : 0;

        return {
          totalDias: historial.length,
          totalArchivos,
          promedioGeneralMinutos: promedioGeneral,
          archivoStats,
          clasificaciones
        };
      };

      const calcularTotalVideosDelDia = () => {
        let totalVideos = 0;
        const desglose = [];
        
        archivos.forEach(archivo => {
          const trabajo = trabajosActivos[archivo];
          if (trabajo.horaInicio && trabajo.horaFin) {
            const tiempo = calcularTiempoTranscurrido(trabajo.horaInicio, trabajo.periodoInicio, trabajo.horaFin, trabajo.periodoFin, trabajo.diaSiguiente, archivo);
            const clasificacion = obtenerClasificacionProductividad(tiempo.totalMinutos, trabajo.horaInicio, trabajo.periodoInicio, trabajo.horaFin, trabajo.periodoFin);
            
            let valorVideo = 0;
            let descripcion = '';
            
            if (clasificacion.nombre === 'Rendimiento √ìptimo' || clasificacion.nombre === 'Plazo M√°ximo') {
              valorVideo = 1;
              descripcion = '1 video completo';
            } else if (clasificacion.nombre === 'Entrega Atrasada') {
              valorVideo = 0.75;
              descripcion = '3/4 de video';
            } else if (clasificacion.nombre === 'Entrega Tard√≠a') {
              valorVideo = 0.5;
              descripcion = '1/2 video';
            } else if (clasificacion.nombre === 'Entrega Nula') {
              valorVideo = 0;
              descripcion = 'No se cuenta';
            }
            
            totalVideos += valorVideo;
            desglose.push({
              archivo,
              clasificacion: clasificacion.nombre,
              valor: valorVideo,
              descripcion
            });
          }
        });
        
        return { totalVideos, desglose };
      };

      const resultadoDia = calcularTotalVideosDelDia();
      const stats = calcularEstadisticasGenerales();

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-4">
              <div className="flex items-center justify-center gap-3 mb-2">
                <Clock className="w-10 h-10 text-purple-400" />
                <h1 className="text-4xl font-bold text-white">
                  Control de Entrega de Videos
                </h1>
              </div>
              <p className="text-gray-300 text-sm">Monitoreo diario de archivos G1-G7</p>
            </div>

            <div className="mb-4 bg-gray-800/50 backdrop-blur-lg rounded-xl p-4 shadow-2xl border border-purple-500/20">
              <div className="flex items-center justify-between gap-4">
                <div className="flex items-center gap-4">
                  <div className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl p-4 shadow-lg border-2 border-purple-400/50">
                    <label className="block text-purple-100 text-sm font-bold mb-2">üìÖ Fecha de Trabajo</label>
                    <input
                      type="date"
                      value={fechaActual}
                      onChange={(e) => setFechaActual(e.target.value)}
                      className="bg-white/20 backdrop-blur-sm text-white rounded-lg px-4 py-3 text-xl font-bold focus:outline-none focus:ring-2 focus:ring-white border-2 border-white/30"
                    />
                  </div>
                  <div className="bg-gradient-to-br from-cyan-600 to-blue-600 rounded-xl p-4 shadow-lg border-2 border-cyan-400/50 min-w-[200px]">
                    <p className="text-cyan-100 text-sm font-bold mb-2">D√≠a de la Semana</p>
                    <p className="text-white font-bold text-3xl">{obtenerDiaSemana(fechaActual)}</p>
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={tomarCapturaPantalla}
                    className="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center gap-2"
                  >
                    <Camera className="w-5 h-5" />
                    Tomar Screen
                  </button>
                  
                  <button
                    onClick={guardarDia}
                    className="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center gap-2"
                  >
                    <Save className="w-5 h-5" />
                    Guardar D√≠a
                  </button>
                  
                  <button
                    onClick={() => setMostrarHistorial(!mostrarHistorial)}
                    className="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center gap-2"
                  >
                    <History className="w-5 h-5" />
                    Historial ({historial.length})
                  </button>
                  
                  <button
                    onClick={() => setMostrarEstadisticas(!mostrarEstadisticas)}
                    className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center gap-2"
                  >
                    <BarChart3 className="w-5 h-5" />
                    Estad√≠sticas
                  </button>
                </div>
              </div>
            </div>

            <div className="mb-4 bg-gray-800/50 backdrop-blur-lg rounded-xl p-4 shadow-2xl border border-purple-500/20">
              <h2 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-purple-400" />
                Reglas de Productividad
              </h2>
              
              {/* Primera fila - Reglas de tiempo */}
              <div className="flex gap-3 overflow-x-auto pb-2 mb-3">
                <div className="flex-1 min-w-[200px] bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl p-4 border-2 border-green-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">‚úÖ</p>
                    <p className="text-white font-bold text-base mb-2">Rendimiento √ìptimo</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-2xl">0 - 60 min</p>
                      <p className="text-green-100 text-xs">85% de promedio = BONO</p>
                    </div>
                  </div>
                </div>

                <div className="flex-1 min-w-[200px] bg-gradient-to-br from-cyan-600 to-blue-600 rounded-xl p-4 border-2 border-cyan-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">üéØ</p>
                    <p className="text-white font-bold text-base mb-2">Plazo M√°ximo</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-2xl">61 - 90 min</p>
                      <p className="text-cyan-100 text-xs">No hay penalidad</p>
                      <p className="text-cyan-100 text-xs">85% de promedio = BONO</p>
                    </div>
                  </div>
                </div>

                <div className="flex-1 min-w-[200px] bg-gradient-to-br from-purple-600 to-violet-600 rounded-xl p-4 border-2 border-purple-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">‚è∞</p>
                    <p className="text-white font-bold text-base mb-2">Entrega Atrasada</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-2xl">91 - 150 min</p>
                      <p className="text-purple-100 text-xs">Solo se contar√° 3/4 del video</p>
                      <p className="text-purple-100 text-xs">No enviar: descuento 1/2 del pr√≥ximo</p>
                    </div>
                  </div>
                </div>

                <div className="flex-1 min-w-[200px] bg-gradient-to-br from-yellow-600 to-orange-600 rounded-xl p-4 border-2 border-yellow-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">‚ö†Ô∏è</p>
                    <p className="text-white font-bold text-base mb-2">Entrega Tard√≠a</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-2xl">150 - 180 min</p>
                      <p className="text-yellow-100 text-xs">Solo se contar√° 1/2 del video</p>
                      <p className="text-yellow-100 text-xs">No enviar: descuento 1/2 del pr√≥ximo</p>
                    </div>
                  </div>
                </div>

                <div className="flex-1 min-w-[200px] bg-gradient-to-br from-red-600 to-pink-600 rounded-xl p-4 border-2 border-red-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">‚úñÔ∏è</p>
                    <p className="text-white font-bold text-base mb-2">Entrega Nula</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-2xl">+180 min</p>
                      <p className="text-red-100 text-xs">Ya anulado, pero debe enviarse</p>
                      <p className="text-red-100 text-xs">No enviar: descuento 1/2 del pr√≥ximo</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Segunda fila - Reglas especiales */}
              <div className="grid md:grid-cols-3 gap-3 mb-3">
                <div className="bg-gradient-to-br from-orange-600 to-amber-600 rounded-xl p-4 border-2 border-orange-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">üçΩ</p>
                    <p className="text-white font-bold text-base mb-2">Pausa de Almuerzo</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-lg">12:00 PM - 1:30 PM</p>
                      <p className="text-orange-100 text-xs">No se contabiliza tiempo</p>
                      <p className="text-white font-bold text-sm mt-1">= -90 min</p>
                    </div>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-pink-600 to-rose-600 rounded-xl p-4 border-2 border-pink-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">üé¶</p>
                    <p className="text-white font-bold text-base mb-2">Env√≠o de Clips</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-lg">10 PM - 1 AM</p>
                      <p className="text-white font-bold text-lg">9 AM - 7 PM</p>
                      <p className="text-pink-100 text-xs mt-1">De acuerdo a disponibilidad de clips</p>
                    </div>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl p-4 border-2 border-indigo-400/50 shadow-lg transform hover:scale-105 transition-all">
                  <div className="text-center">
                    <p className="text-3xl mb-2">üåô</p>
                    <p className="text-white font-bold text-base mb-2">Exoneraci√≥n Nocturna</p>
                    <div className="bg-white/20 rounded-lg py-2 px-3 backdrop-blur-sm">
                      <p className="text-white font-bold text-lg">10 PM - 1 AM</p>
                      <p className="text-indigo-100 text-xs">Recepci√≥n en horario nocturno</p>
                      <p className="text-white font-bold text-lg mt-1">‚Üí Antes 9 AM</p>
                      <p className="text-indigo-100 text-xs">= Rendimiento √ìptimo autom√°tico</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Tercera fila - Regla de recepciones m√∫ltiples */}
              <div className="bg-gradient-to-br from-teal-600 to-emerald-700 rounded-xl p-4 border-2 border-teal-400/50 shadow-lg">
                <div className="flex items-start gap-3">
                  <p className="text-4xl">‚ö°</p>
                  <div className="flex-1">
                    <p className="text-white font-bold text-base mb-2">üì• Regla de Recepciones M√∫ltiples</p>
                    <div className="bg-white/20 rounded-lg py-2 px-4 backdrop-blur-sm">
                      <p className="text-teal-100 text-sm mb-2">
                        <span className="font-bold text-white">Si dos videos se reciben con menos de 1h 30min de diferencia:</span>
                      </p>
                      <p className="text-teal-100 text-xs">
                        ‚Ä¢ El segundo video comienza a contarse despu√©s de 1h 30min del primero
                      </p>
                      <p className="text-teal-100 text-xs">
                        ‚Ä¢ Ejemplo: Video 1 (11:00 AM) y Video 2 (11:10 AM) ‚Üí Video 2 inicia conteo a las 12:30 PM
                      </p>
                      <p className="text-teal-100 text-xs mt-2">
                        ‚Ä¢ Si ambos finalizan con m√°s de 2h de diferencia, se cuentan independientemente
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {mostrarEstadisticas && stats && (
              <div className="mb-4 bg-gray-800/50 backdrop-blur-lg rounded-xl p-4 shadow-2xl border border-yellow-500/20">
                <h2 className="text-2xl font-bold text-white mb-4">üìä Estad√≠sticas</h2>
                <div className="grid md:grid-cols-4 gap-3">
                  <div className="bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg p-3">
                    <p className="text-purple-100 text-xs">D√≠as Registrados</p>
                    <p className="text-white font-bold text-2xl">{stats.totalDias}</p>
                  </div>
                  <div className="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-lg p-3">
                    <p className="text-blue-100 text-xs">Archivos Procesados</p>
                    <p className="text-white font-bold text-2xl">{stats.totalArchivos}</p>
                  </div>
                  <div className="bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg p-3">
                    <p className="text-green-100 text-xs">Promedio General</p>
                    <p className="text-white font-bold text-xl">
                      {Math.floor(stats.promedioGeneralMinutos / 60)}h {Math.round(stats.promedioGeneralMinutos % 60)}m
                    </p>
                  </div>
                  <div className="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-3">
                    <p className="text-orange-100 text-xs">Promedio por D√≠a</p>
                    <p className="text-white font-bold text-xl">
                      {stats.totalDias > 0 ? Math.floor(stats.totalArchivos / stats.totalDias) : 0} archivos
                    </p>
                  </div>
                </div>
              </div>
            )}

            {mostrarHistorial && (
              <div className="mb-4 bg-gray-800/50 backdrop-blur-lg rounded-xl p-4 shadow-2xl border border-blue-500/20">
                <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                  <History className="w-6 h-6 text-blue-400" />
                  Historial de Entregas
                </h2>
                {historial.length === 0 ? (
                  <div className="text-center py-8">
                    <p className="text-gray-400 text-lg">No hay registros guardados a√∫n</p>
                    <p className="text-gray-500 text-sm mt-2">Completa los archivos y haz clic en "Guardar D√≠a"</p>
                  </div>
                ) : (
                  <div className="space-y-3 max-h-[600px] overflow-y-auto">
                    {historial.map((dia) => (
                      <div key={dia.id} className="bg-gray-900/50 rounded-xl p-4 border border-purple-500/30">
                        <div className="flex items-center justify-between mb-3">
                          <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg px-4 py-2">
                              <p className="text-white font-bold text-lg">{dia.fecha}</p>
                            </div>
                            <div className="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-lg px-4 py-2">
                              <p className="text-white font-bold">{dia.diaSemana}</p>
                            </div>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="text-gray-400 text-sm">
                              {Object.keys(dia.archivos).length} archivo(s) procesado(s)
                            </div>
                            <button
                              onClick={() => copiarTextoAlPortapapeles(dia)}
                              className="bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center gap-2"
                              title="Copiar texto del reporte"
                            >
                              <Copy className="w-4 h-4" />
                              Copiar
                            </button>
                            <button
                              onClick={() => descargarReporteTxt(dia)}
                              className="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center gap-2"
                              title="Descargar reporte en .txt"
                            >
                              <Download className="w-4 h-4" />
                              Descargar
                            </button>
                          </div>
                        </div>
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                          {Object.entries(dia.archivos).map(([archivo, datos]) => {
                            const clasificacion = obtenerClasificacionProductividad(datos.duracion.totalMinutos);
                            const esExonerado = datos.exonerado || false;
                            return (
                              <div key={archivo} className={`${clasificacion.bg} rounded-lg p-3 border border-white/10`}>
                                <div className="flex items-center justify-between mb-2">
                                  <span className="text-white font-bold text-lg">{archivo}</span>
                                  <span className="text-2xl">{clasificacion.emoji}</span>
                                </div>
                                <div className="space-y-1 text-sm">
                                  <p className="text-gray-200">
                                    <span className="text-blue-300">üî•</span> {datos.horaInicio}
                                  </p>
                                  <p className="text-gray-200">
                                    <span className="text-pink-300">‚úÖ</span> {datos.horaFin}
                                  </p>
                                  <p className="text-white font-bold text-base mt-2">
                                    ‚è±Ô∏è {String(datos.duracion.horas).padStart(2, '0')}:{String(datos.duracion.minutos).padStart(2, '0')}:{String(datos.duracion.segundos).padStart(2, '0')}
                                  </p>
                                  <div className="flex items-center gap-2">
                                    <p className={`${clasificacion.color} font-bold text-xs`}>
                                      {clasificacion.nombre}
                                    </p>
                                    {esExonerado && (
                                      <span className="text-xs bg-white/20 px-2 py-0.5 rounded text-white">üåô</span>
                                    )}
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            <div className="space-y-3">
              {archivos.map((archivo) => {
                const trabajo = trabajosActivos[archivo];
                const tiempo = calcularTiempoTranscurrido(trabajo.horaInicio, trabajo.periodoInicio, trabajo.horaFin, trabajo.periodoFin, trabajo.diaSiguiente, archivo);
                const clasificacion = obtenerClasificacionProductividad(tiempo.totalMinutos, trabajo.horaInicio, trabajo.periodoInicio, trabajo.horaFin, trabajo.periodoFin);
                const colorRendimiento = obtenerColorRendimiento(tiempo.totalMinutos, clasificacion.exonerado);
                
                return (
                  <div 
                    key={archivo}
                    className="bg-gray-800/50 backdrop-blur-lg rounded-xl p-5 shadow-2xl border border-purple-500/20 hover:border-purple-500/50 transition-all"
                  >
                    <div className="flex items-center gap-5">
                      <div className="flex-shrink-0">
                        <div className="w-20 h-20 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center shadow-xl border-2 border-purple-400/50">
                          <span className="text-white font-bold text-3xl">{archivo}</span>
                        </div>
                      </div>

                      <div className="flex-shrink-0">
                        <label className="block text-blue-400 text-sm font-bold mb-2">üî• Hora Recepci√≥n</label>
                        <div className="flex gap-2">
                          <input
                            type="time"
                            value={trabajo.horaInicio}
                            onChange={(e) => cambiarHoraInicio(archivo, e.target.value)}
                            disabled={trabajo.enProceso}
                            className="w-32 bg-gradient-to-br from-gray-700 to-gray-800 text-white rounded-xl px-3 py-3 text-lg font-bold focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 border-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                          />
                          <select
                            value={trabajo.periodoInicio}
                            onChange={(e) => cambiarPeriodoInicio(archivo, e.target.value)}
                            disabled={trabajo.enProceso}
                            className="w-20 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-xl px-2 py-3 text-base font-bold focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 border-blue-400/50 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                          >
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                          </select>
                        </div>
                      </div>

                      <div className="flex-shrink-0">
                        <label className="block text-pink-400 text-sm font-bold mb-2">‚úÖ Hora Finalizaci√≥n</label>
                        <div className="flex gap-2">
                          <input
                            type="time"
                            value={trabajo.horaFin}
                            onChange={(e) => cambiarHoraFin(archivo, e.target.value)}
                            disabled={!trabajo.horaInicio}
                            className="w-32 bg-gradient-to-br from-gray-700 to-gray-800 text-white rounded-xl px-3 py-3 text-lg font-bold focus:outline-none focus:ring-2 focus:ring-pink-500 border-2 border-pink-500/30 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                          />
                          <select
                            value={trabajo.periodoFin}
                            onChange={(e) => cambiarPeriodoFin(archivo, e.target.value)}
                            disabled={!trabajo.horaInicio}
                            className="w-20 bg-gradient-to-br from-pink-600 to-pink-700 text-white rounded-xl px-2 py-3 text-base font-bold focus:outline-none focus:ring-2 focus:ring-pink-500 border-2 border-pink-400/50 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                          >
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                          </select>
                          <button
                            onClick={() => toggleDiaSiguiente(archivo)}
                            disabled={!trabajo.horaInicio}
                            className={`px-3 py-2 rounded-xl font-bold text-sm transition-all shadow-lg border-2 disabled:opacity-50 disabled:cursor-not-allowed ${
                              trabajo.diaSiguiente 
                                ? 'bg-gradient-to-br from-purple-600 to-purple-700 text-white border-purple-400/50' 
                                : 'bg-gradient-to-br from-gray-600 to-gray-700 text-gray-300 border-gray-500/30'
                            }`}
                            title="Marcar si la finalizaci√≥n es al d√≠a siguiente"
                          >
                            +1
                          </button>
                        </div>
                      </div>

                      <div className="flex-grow min-w-[500px]">
                        <label className="block text-cyan-400 text-sm font-bold mb-2">‚è±Ô∏è Tiempo Transcurrido</label>
                        <div className={`bg-gradient-to-r ${colorRendimiento} rounded-xl p-4 shadow-lg`}>
                          {trabajo.horaInicio ? (
                            <div className="flex items-center justify-center gap-4">
                              <p className="text-white font-bold text-3xl whitespace-nowrap">
                                {tiempo.horas}h {tiempo.minutos}min
                              </p>
                              {trabajo.horaFin && (
                                <>
                                  <span className="text-white text-3xl font-bold">=</span>
                                  <p className="text-white font-bold text-2xl flex items-center gap-2 whitespace-nowrap">
                                    {clasificacion.emoji} {clasificacion.nombre}
                                    {clasificacion.exonerado && (
                                      <span className="text-base bg-white/20 px-2 py-1 rounded-lg">üåô Exonerado</span>
                                    )}
                                  </p>
                                </>
                              )}
                            </div>
                          ) : (
                            <p className="text-white/60 text-2xl text-center">--h --min</p>
                          )}
                        </div>
                      </div>

                      <div className="flex-shrink-0 flex gap-2">
                        {(trabajo.horaInicio || trabajo.horaFin) && (
                          <button
                            onClick={() => reiniciarTrabajo(archivo)}
                            className="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-2 px-3 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center justify-center"
                          >
                            <RotateCcw className="w-4 h-4" />
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ControlTiempoTrabajos />);
  </script>
</body>
</html>